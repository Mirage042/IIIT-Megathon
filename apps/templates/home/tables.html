{% extends "layouts/base.html" %} {% block title %} Tables {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
<style>
  :root {
    --sidebar-width: 350px; /* Default sidebar width */
  }

  /* Main container adjustments for sidebar and navbar */
  .chat-container {
    position: relative;
    width: calc(100vw - var(--sidebar-width));
    height: calc(100vh - 70px);
    margin-left: var(--sidebar-width);
    margin-top: 70px;
    padding: 20px;
    overflow: hidden;
    transition: all 0.3s ease; /* Smooth transition when width changes */
  }

  .chat-area {
    height: 100%;
    display: flex;
    flex-direction: column;
    background-color: transparent;
    max-width: 1500px; /* Prevent excessive stretching on wide screens */
    margin: 0 auto; /* Center the chat area */
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 20px;
    width: 100%;
  }

  .message {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 8px;
    margin: 4px 0;
    word-wrap: break-word; /* Prevent text overflow */
    color: white;
  }

  .input-area {
    display: flex;
    gap: 10px;
    padding: 20px;
    background-color: #2d2d3c;
    border-radius: 12px;
    position: sticky;
    bottom: 0;
    width: 100%;
    box-sizing: border-box;
  }

  .user-msg {
    background-color: #2d2d3c;
    align-self: flex-end;
    color: white;
  }

  .assistant-message {
    background-color: #383850;
    align-self: flex-start;
  }

  .input-area {
    display: flex;
    gap: 10px;
    padding: 20px;
    background-color: #2d2d3c;
    border-radius: 12px;
    position: sticky;
    bottom: 0;
  }

  .message-input {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 8px;
    background-color: #383850;
    color: white;
    font-size: 16px;
    resize: none;
    min-height: 48px;
    max-height: 150px;
  }

  .message-input:focus {
    outline: none;
    background-color: #434360;
  }

  .send-button,
  .upload-button {
    background-color: #c026d3;
    border: none;
    border-radius: 8px;
    padding: 0 20px;
    color: white;
    cursor: pointer;
    transition: background-color 0.2s;
    height: 48px; /* Match input height */
    min-width: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .send-button:hover,
  .upload-button:hover {
    background-color: #9333ea;
  }

  .file-input {
    display: none;
  }

  .welcome-message {
    text-align: center;
    margin: 40px 0;
    font-size: 32px;
    background: linear-gradient(90deg, #c026d3, #9333ea);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  .notification {
    position: fixed;
    top: 90px; /* Adjusted to be below navbar */
    right: 20px;
    padding: 12px 20px;
    background-color: #4caf50;
    color: white;
    border-radius: 8px;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 1000;
  }

  .chat-container {
    position: relative;
    width: calc(
      100vw - var(--sidebar-width, 100px)
    ); /* Adjustable for sidebar */
    height: calc(100vh - 70px); /* Adjust for navbar */
    margin-left: var(--sidebar-width, 100px); /* Match sidebar width */
    margin-top: 70px; /* Match navbar height */
    padding: 20px;
    overflow: hidden;
  }

  .notification.show {
    opacity: 1;
  }

  /* Custom scrollbar for chat messages */
  .chat-messages::-webkit-scrollbar {
    width: 6px;
  }

  .chat-messages::-webkit-scrollbar-track {
    background: transparent;
  }

  .chat-messages::-webkit-scrollbar-thumb {
    background: #4a4a4a;
    border-radius: 3px;
  }

  .chat-messages::-webkit-scrollbar-thumb:hover {
    background: #5a5a5a;
  }
</style>
{% endblock stylesheets %} {% block content %}
<div class="chat-container">
  <main class="chat-area">
    <div class="chat-messages" id="chatMessages">
      <div class="welcome-message">Hello, Welcome to Chat</div>
    </div>
    <div class="input-area">
      <textarea
        class="message-input"
        placeholder="Type a message..."
        id="messageInput"
      ></textarea>
      <button
        class="upload-button"
        onclick="document.getElementById('fileInput').click()"
      >
        ðŸ“·
      </button>
      <input
        type="file"
        id="fileInput"
        class="file-input"
        accept="image/png,image/jpeg"
        onchange="handleImageUpload(event)"
      />
      <button class="send-button" onclick="sendMessage()">Send</button>
    </div>
  </main>
</div>
<div id="notification" class="notification"></div>
{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
  // Adjust textarea height automatically
  const messageInput = document.getElementById("messageInput");
  messageInput.addEventListener("input", function () {
    this.style.height = "auto";
    this.style.height = Math.min(this.scrollHeight, 150) + "px";
  });

  function storeImage(file) {
    return `Image "${file.name}" has been uploaded successfully`;
  }

  function showNotification(message) {
    const notification = document.getElementById("notification");
    notification.textContent = message;
    notification.classList.add("show");

    setTimeout(() => {
      notification.classList.remove("show");
    }, 3000);
  }

  async function sendMessage() {
    const input = document.getElementById("messageInput");
    const message = input.value.trim();
    if (message) {
      addMessage(message, "user-msg");
      input.value = "";
      input.style.height = "48px"; // Reset height

      try {
        const response = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: message }),
        });
        const data = await response.json();

        // Check if the response contains an error or a valid response
        if (data.error) {
          addMessage("Error: " + data.error, "assistant-message");
        } else {
          addMessage(data.response, "assistant-message");
        }
      } catch (error) {
        addMessage(
          "An error occurred while communicating with the server.",
          "assistant-message"
        );
        console.error("Error:", error);
      }
    }
  }

  function addMessage(text, className) {
    const messagesDiv = document.getElementById("chatMessages");
    const messageDiv = document.createElement("div");
    messageDiv.className = `message ${className}`;
    messageDiv.textContent = text;
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function handleImageUpload(event) {
    const file = event.target.files[0];
    if (file) {
      const message = storeImage(file);
      showNotification(message);
      addMessage(`Uploaded: ${file.name}`, "user-msg");
      event.target.value = "";
    }
  }

  messageInput.addEventListener("keypress", function (e) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });
</script>
{% endblock javascripts %}
